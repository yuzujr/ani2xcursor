name: Test

on:
  push:
    branches: [ main, master, dev, develop ]
  pull_request:
    branches: [ main, master, dev, develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libxcursor-dev
    
    - name: Setup xmake
      uses: xmake-io/github-action-setup-xmake@v1
      with:
        xmake-version: latest
    
    - name: Build
      run: |
        xmake config -y
        xmake build
    
    - name: Build test binary
      run: xmake build ani2xcursor_test
    
    - name: Run tests
      run: ./build/linux/x86_64/release/ani2xcursor_test
    
    - name: Test conversion (smoke test)
      run: |
        ./build/linux/x86_64/release/ani2xcursor "example/Kobo Cursor" -o /tmp/test_output
        test -f "/tmp/test_output/Kobo's Cursor/cursors/left_ptr"
        test -f "/tmp/test_output/Kobo's Cursor/index.theme"
